############
# COMPILER #
############

#
NVCC      = nvcc
INCLUDES  = -I./src -I./implementations/global
NVCODE    = -gencode arch=compute_80,code=sm_80 -ftz=true
NVFLAGS   = -O3 -std=c++14 $(NVCODE) $(INCLUDES) -rdc=true

###########
# SOURCES #
###########

SRCS_ROOT = $(wildcard *.cpp)
SRCS_SRC  = $(wildcard src/*.cpp)
SRCS_KERNELS =  implementations/tiled/kernel_tiled.cu implementations/tiled_with_halos/kernel_tiled_with_halo.cu implementations/cfame/kernel_cfame.cu implementations/cfamo/kernel_cfamo.cu implementations/global/kernel_global.cu constants.cu Sciara.cu
SRCS_MAIN = sciara_fv2.cu 

ALL_SOURCES = $(SRCS_ROOT) $(SRCS_SRC) $(SRCS_KERNELS) $(SRCS_MAIN) 

###########
# DATASET #
###########

INPUT_CONFIG=./data/2006/2006_000000000000.cfg
OUTPUT_CONFIG=./data/2006/output_2006
OUTPUT=./data/2006/output_2006_000000016000_Temperature.asc #md5sum: 0c071cd864046d3c6aaf30997290ad6c
STEPS=1000
REDUCE_INTERVL=1000
THICKNESS_THRESHOLD=1.0

###############
# COMPILATION #
###############

EXEC_CUDA = sciara_cuda

default: all

all: $(EXEC_CUDA)

$(EXEC_CUDA):
	$(NVCC) $(NVFLAGS) $(ALL_SOURCES) -o $(EXEC_CUDA)

#############
# EXECUTION #
#############

run_cuda: $(EXEC_CUDA)
	./$(EXEC_CUDA) $(INPUT_CONFIG) $(OUTPUT_CONFIG) $(STEPS) $(REDUCE_INTERVL) $(THICKNESS_THRESHOLD) && md5sum $(OUTPUT)

############
# CLEAN UP #
############

clean:
	rm -f $(EXEC_CUDA) *.o *output*

wipe:
	rm -f *.o ./data/2006/*output*

